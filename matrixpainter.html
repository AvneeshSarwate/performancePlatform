<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 
<html lang="en">
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8"> 
	<link rel="stylesheet" type="text/css" href="matrixpainter.css">
 	<title>Title Goes Here</title> 
</head> 
<body>
	<div id="gridholder"></div>
	<button id="selectorToggle" class="selected">on</button>
</body> 
<script type="text/javascript">
	var lastClicked;
	var selecting = true;
	var mouseDown = false;
	var height = 32, width = 32;
	var grid = clickableGrid(height,width,function(el,row,col,i){
	    console.log("You clicked on element:",el, row, col, i);

	    el.className='selected';
	    el.setAttribute("vidIndex", 1);

	    if (lastClicked) lastClicked.className='';
	    lastClicked = el;
	});

	document.getElementById('gridholder').appendChild(grid);

	// document.getElementById('gridholder').addEventListener('mousedown', function(el) {mouseDown = true; console.log("mouse", mouseDown)});
	// document.getElementById('gridholder').addEventListener('mouseup', function(el) {mouseDown = false; console.log("mouse", mouseDown)});
	
	document.getElementById('selectorToggle').addEventListener('click', function(el){
		selecting = !selecting;
		el.target.className = selecting ? 'selected' : 'unselected';
		el.target.innerHTML = selecting ? "on" : "off";
		console.log("click toggle", el, mouseDown);
	});

	function clickableGrid( rows, cols, callback ){
	    var i=0;
	    var grid = document.createElement('table');
	    grid.className = 'grid';
	    for (var r=0;r<rows;++r){
	        var tr = grid.appendChild(document.createElement('tr'));
	        for (var c=0;c<cols;++c){
	            var cell = tr.appendChild(document.createElement('td'));
	            //cell.innerHTML = ++i;
	            cell.addEventListener('mousedown', function(el) {
	            	mouseDown = true;
	            	if(selecting){
	            		el.target.setAttribute("vidIndex", 1);
	            	} else {
	            		el.target.setAttribute("vidIndex", 0);
	            	}	
	            });
	            cell.addEventListener('mouseup', function(el) {
	            	mouseDown = false;
	            });
	            cell.addEventListener('mouseover', function(el) {
	            	if(mouseDown) {
		            	if(selecting){
		            		el.target.setAttribute("vidIndex", 1);
		            	} else {
		            		el.target.setAttribute("vidIndex", 0);
		            	}
		            }
	            });
	        }
	    }
	    return grid;
	}
</script>
</html>